# Phase 4-6 デバッグチェックリスト

## Phase 4: ノードリンク機能のUI実装

### 4.1 バックエンドAPI: ノードリンク削除
**確認項目:**
- [ ] `DELETE /api/v1/nodes/{node_id}/links/` エンドポイントが存在する
- [ ] リクエストボディに `link_id` を含めて送信できる
- [ ] 正常な削除で `204 No Content` が返る
- [ ] 存在しない `link_id` で `404 Not Found` が返る
- [ ] 他のノードのリンクを削除しようとすると `403 Forbidden` が返る

**テスト手順:**
1. ノードAとノードBを作成
2. ノードAからノードBへのリンクを作成
3. リンクIDを取得
4. `DELETE /api/v1/nodes/{nodeA_id}/links/` に `{"link_id": "..."}` を送信
5. レスポンスを確認
6. リンクが削除されたことを確認（GETでリンク一覧を取得）

### 4.2 フロントエンドAPIクライアント: リンク削除メソッド
**確認項目:**
- [ ] `nodeApi.deleteLink(nodeId, linkId)` メソッドが存在する
- [ ] 正しいエンドポイントにリクエストを送信する
- [ ] エラーハンドリングが適切に実装されている

**テスト手順:**
1. ブラウザの開発者ツールでネットワークタブを開く
2. ノード詳細画面でリンクを削除
3. リクエストが正しく送信されているか確認

### 4.3 ノード詳細画面: リンク表示セクション
**確認項目:**
- [ ] ノード詳細画面に「ノードリンク」セクションが表示される
- [ ] 送信リンク（outgoing links）が正しく表示される
- [ ] 受信リンク（incoming links）が正しく表示される
- [ ] リンク先ノードのタイトルが表示される（IDではなく）
- [ ] リンクがない場合に「リンクがありません」と表示される
- [ ] 重み（weight）が表示される

**テスト手順:**
1. ノードA、ノードB、ノードCを作成
2. ノードAからノードBへのリンク（重み0.7）を作成
3. ノードCからノードAへのリンク（重み0.5）を作成
4. ノードAの詳細画面を開く
5. 送信リンクに「→ ノードBのタイトル 重み: 0.7」が表示されることを確認
6. 受信リンクに「← ノードCのタイトル 重み: 0.5」が表示されることを確認

### 4.4 リンク作成フォーム
**確認項目:**
- [ ] `NodeLinkCreateForm.svelte` コンポーネントが存在する
- [ ] リンク先ノードのドロップダウンが表示される
- [ ] 利用可能なノード一覧が正しく取得される
- [ ] 現在のノードが選択肢から除外される
- [ ] 重み（weight）の入力フィールドが表示される（デフォルト0.5）
- [ ] 重みの範囲バリデーション（0.1〜1.0）が機能する
- [ ] 同一ノードへのリンク作成が禁止される（エラーメッセージ表示）
- [ ] 既存リンクの重複チェックが機能する（エラーメッセージ表示）
- [ ] リンク作成成功時にフォームが閉じる
- [ ] リンク一覧が自動的に更新される

**テスト手順:**
1. ノードAの詳細画面を開く
2. 「リンクを追加」ボタンをクリック
3. フォームが表示されることを確認
4. リンク先ノードを選択（ノードAは選択肢に含まれていないことを確認）
5. 重みを0.3に設定
6. 「作成」ボタンをクリック
7. リンクが作成され、一覧に表示されることを確認
8. 再度「リンクを追加」をクリック
9. 既にリンク済みのノードを選択して作成を試みる
10. エラーメッセージが表示されることを確認

### 4.5 リンク削除機能
**確認項目:**
- [ ] 各リンクに「削除」ボタンが表示される
- [ ] 削除ボタンをクリックすると確認ダイアログが表示される
- [ ] 確認ダイアログで「キャンセル」を選択すると削除されない
- [ ] 確認ダイアログで「OK」を選択するとリンクが削除される
- [ ] 削除後、リンク一覧が自動的に更新される
- [ ] 削除エラー時にエラーメッセージが表示される

**テスト手順:**
1. ノードAからノードBへのリンクを作成
2. ノードAの詳細画面でリンク一覧を確認
3. 「削除」ボタンをクリック
4. 確認ダイアログが表示されることを確認
5. 「キャンセル」を選択し、リンクが残ることを確認
6. 再度「削除」ボタンをクリック
7. 「OK」を選択
8. リンクが削除され、一覧から消えることを確認

### 4.6 リンク先ノードへの遷移
**確認項目:**
- [ ] 送信リンクのノードタイトルをクリックすると、リンク先ノードの詳細画面に遷移する
- [ ] 受信リンクのノードタイトルをクリックすると、リンク元ノードの詳細画面に遷移する
- [ ] 遷移後、正しいノードの詳細が表示される

**テスト手順:**
1. ノードAからノードBへのリンクを作成
2. ノードAの詳細画面で送信リンクの「→ ノードBのタイトル」をクリック
3. ノードBの詳細画面に遷移することを確認
4. ノードBの詳細画面で受信リンクの「← ノードAのタイトル」をクリック
5. ノードAの詳細画面に戻ることを確認

---

## Phase 5: 2〜5周の改善ループ

### 5.1 バックエンドAPI: 周の更新
**確認項目:**
- [ ] `PUT /api/v1/rounds/{round_id}/` エンドポイントが存在する
- [ ] `note` フィールドを更新できる
- [ ] 正常な更新で更新された周データが返る
- [ ] 存在しない `round_id` で `404 Not Found` が返る
- [ ] 他のユーザーの周を更新しようとすると `403 Forbidden` が返る

**テスト手順:**
1. プロジェクトを作成
2. 第1周を作成（note: "初期メモ"）
3. `PUT /api/v1/rounds/{round_id}/` に `{"note": "更新されたメモ"}` を送信
4. レスポンスで `note` が更新されていることを確認
5. GETで周を取得し、`note` が更新されていることを確認

### 5.2 周カウンター表示
**確認項目:**
- [ ] プロジェクト詳細画面に周カウンターが表示される
- [ ] 「第X周 / 5周」の形式で表示される
- [ ] 周が0の場合、カウンターが表示されない（または「第0周 / 5周」と表示される）
- [ ] 周が1の場合、「第1周 / 5周」と表示される
- [ ] 周が5の場合、「第5周 / 5周」と表示される

**テスト手順:**
1. プロジェクトを作成
2. プロジェクト詳細画面を開く
3. 周カウンターが表示されないことを確認（周が0）
4. 第1周を作成
5. 周カウンターに「第1周 / 5周」と表示されることを確認
6. 第2周、第3周を作成
7. 周カウンターに「第3周 / 5周」と表示されることを確認

### 5.3 「なんか思いついた？」入力欄
**確認項目:**
- [ ] 周作成フォームに「なんか思いついた？」ラベルのテキストエリアが表示される
- [ ] テキストエリアに「思いついたことや違和感を入力してください（任意）」というプレースホルダーが表示される
- [ ] 入力した内容が `note` フィールドとして保存される
- [ ] 既存の周を編集する場合、前回の内容が表示される（将来実装）

**テスト手順:**
1. プロジェクト詳細画面で「+ 周を追加」をクリック
2. 周作成フォームが表示されることを確認
3. 「なんか思いついた？」テキストエリアが表示されることを確認
4. 「思いついたこと: ユーザー認証が必要」と入力
5. 周番号を1に設定して「作成」をクリック
6. 作成された周の詳細で「思いついたこと: ユーザー認証が必要」が表示されることを確認

### 5.4 前周の内容読み込み機能
**確認項目:**
- [ ] 2周目以降の周で「前周（第X周）の内容」セクションが表示される
- [ ] 前周のステップが正しく表示される
- [ ] 前周のステップタイプと内容が表示される
- [ ] 1周目では前周の内容が表示されない

**テスト手順:**
1. プロジェクトを作成
2. 第1周を作成し、ステップ1（俯瞰）とステップ2（要素抽出）を作成
3. 第2周を作成
4. 第2周のセクションで「前周（第1周）の内容」が表示されることを確認
5. 前周のステップ1とステップ2の内容が表示されることを確認
6. 第1周のセクションで前周の内容が表示されないことを確認

### 5.5 周のまとめ画面
**確認項目:**
- [ ] `RoundSummary.svelte` コンポーネントが存在する
- [ ] 周のまとめ画面に「第X周のまとめ」というタイトルが表示される
- [ ] 「なんか思いついた？」の内容が表示される（入力されている場合）
- [ ] ステップ一覧が表示される（ステップ数も表示）
- [ ] ノード一覧が表示される（ノード数も表示）
- [ ] 2〜4周目で「次の周へ」ボタンが表示される
- [ ] 5周目で「完成」ボタンが表示される
- [ ] すべての周で「ペンディングにする」ボタンが表示される
- [ ] ボタンクリック時に適切なイベントが発火される

**テスト手順:**
1. プロジェクトを作成
2. 第1周を作成し、ステップとノードを追加
3. 周のまとめ画面を表示（実装方法に応じて）
4. 「第1周のまとめ」が表示されることを確認
5. ステップ一覧とノード一覧が表示されることを確認
6. 「次の周へ」ボタンが表示されることを確認（1周目）
7. 第5周を作成
8. 第5周のまとめ画面で「完成」ボタンが表示されることを確認

---

## Phase 6: ワードツリー（ノード可視化）

**注意:** Phase 6はまだ実装されていません。実装後にデバッグチェックリストを追加します。

### 6.1 ノードのカード表示（将来実装）
**確認項目:**
- [ ] ノードがカード形式で表示される
- [ ] カードにノードのタイトルが表示される
- [ ] カードにノードの文脈（context）が表示される

### 6.2 ノード間リンクの線表示（将来実装）
**確認項目:**
- [ ] ノード間のリンクが線で表示される
- [ ] リンクの重みに応じて線の太さや色が変わる
- [ ] 送信リンクと受信リンクが区別される

### 6.3 プロジェクト単位での表示（将来実装）
**確認項目:**
- [ ] プロジェクトに紐づくノードのみが表示される
- [ ] グローバルノードは表示されない（または別途表示）

### 6.4 ノードクリックで詳細表示（将来実装）
**確認項目:**
- [ ] カードをクリックするとノード詳細画面に遷移する
- [ ] 詳細画面でノードの情報が表示される

### 6.5 ズームイン・ズームアウト（将来実装）
**確認項目:**
- [ ] ズームイン機能が動作する
- [ ] ズームアウト機能が動作する
- [ ] ズームレベルに応じて表示が適切に更新される

---

## 統合テスト

### Phase 4 + Phase 5 の統合
**確認項目:**
- [ ] ノードリンク機能と周の改善ループが同時に動作する
- [ ] 周ごとに異なるノードを作成し、それらをリンクできる
- [ ] 前周のノードと現在の周のノードをリンクできる

**テスト手順:**
1. プロジェクトを作成
2. 第1周を作成し、ノードAを作成
3. 第2周を作成し、ノードBを作成
4. ノードAからノードBへのリンクを作成
5. リンクが正しく表示されることを確認

---

## デバッグ時の注意事項

1. **ブラウザの開発者ツールを開く**
   - ネットワークタブでAPIリクエストを確認
   - コンソールタブでエラーメッセージを確認

2. **バックエンドログを確認**
   - `docker compose logs -f backend` でバックエンドのログを確認

3. **データベースの状態を確認**
   - `docker compose exec backend python manage.py shell` でデータベースの状態を確認

4. **エラーメッセージを記録**
   - エラーが発生した場合、エラーメッセージと発生条件を記録

5. **段階的にテスト**
   - 各機能を個別にテストしてから、統合テストを実施

